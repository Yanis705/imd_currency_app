if(null!==localStorage.getItem("token")){let e="https://imdollar-webtech3.herokuapp.com";function appendHistory(){fetch("/api/v1/getLatestTransfers",{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(t=>{console.log(t);let n=document.querySelector(".transactionHistory");n.innerHTML="",e(t);let a=document.createElement("a");a.className="btn",a.setAttribute("href","transfer/history"),a.innerHTML="FULL HISTORY",n.appendChild(a)}).catch(e=>{localStorage.removeItem("token"),window.location="/login"});let e=e=>{if(0===e.data.transfers.length){let e=document.createElement("div");e.className="transaction noTransaction";let t=document.createElement("p");t.className="noTrasactions",t.innerHTML="You don't have any transactions! Let's make one!",e.appendChild(t),document.querySelector(".transactionHistory").appendChild(e)}e.data.transfers.forEach(t=>{let n=t.date,a=new Date(n),o=a.getDate(),r=a.getMonth(),l=t.from,s=t.to,i=t.reason,c=t.IMDollars,d=t._id,m=document.createElement("a");m.setAttribute("href","/transactiondetails/"+d);let p=document.createElement("div");p.className="transaction",m.appendChild(p);let u=document.createElement("div");u.className="transaction__date",p.appendChild(u);let h=document.createElement("p");h.className="transaction__date--large",h.innerHTML=("0"+o).slice(-2),u.appendChild(h);let H=document.createElement("p");H.innerHTML=("0"+r).slice(-2),u.appendChild(H);let f=document.createElement("div");f.className="transaction__info",p.appendChild(f);let g=document.createElement("p");e.data.user.username==l?g.innerHTML=s:e.data.user.username!==l&&(g.innerHTML=l),f.appendChild(g);let L=document.createElement("p");L.className="transaction__info--small",L.innerHTML=i,f.appendChild(L);let T=document.createElement("div");T.className="transaction__amount",p.appendChild(T);let _=document.createElement("p");e.data.user.username==l?(_.innerHTML="-$"+c,_.className="transaction__amount--negative"):e.data.user.username!==l&&(_.innerHTML="+$"+c,_.className="transaction__amount--positive"),T.appendChild(_),document.querySelector(".transactionHistory").appendChild(m)})}}Primus.connect(e,{reconnect:{max:1/0,min:500,retries:10}}).on("data",e=>{"refreshLatestHistory"===e.action&&appendHistory()}),window.onload=appendHistory()}else window.location="/login";